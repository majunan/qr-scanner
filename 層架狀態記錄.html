<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å±¤æ¶ç‹€æ…‹è¨˜éŒ„</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1, h2 { margin-top: 20px; }
    button { 
      margin: 5px; 
      padding: 6px 12px; 
      font-size: 1em; 
      cursor: pointer; 
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    #reader { width: 300px; margin-bottom: 10px; }

    .record {
      border-left: 6px solid #ccc;
      border-bottom: 1px solid #ccc;
      padding: 5px;
      display: flex;
      justify-content: space-between;
      background-color: #f9f9f9;
    }

    .record[data-status="restock"] { border-left-color: orange; }
    .record[data-status="move"]    { border-left-color: dodgerblue; }
    .record[data-status="empty"]  { border-left-color: red; }

    .highlight { background-color: #ffe680 !important; }
    .options label[data-status="restock"] { color: orange; }
    .options label[data-status="move"]     { color: dodgerblue; }
    .options label[data-status="empty"]    { color: red; }

    .left { flex: 1; }
    .time { font-size: 0.9em; color: gray; }

    #statusFilter { font-size: 1em; padding: 4px 8px; }
    #statusStats { margin-top: 10px; font-size: 1em; }
    
    #soundBtn {
      min-width: 120px;
    }
    #soundBtn.enabled {
      background-color: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }
    #soundBtn.disabled {
      background-color: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }
  </style>
</head>
<body>
  <h1>ğŸ“‹ å±¤æ¶ç‹€æ…‹è¨˜éŒ„</h1>
  <button id="soundBtn" class="disabled">ğŸ”‡ éŸ³æ•ˆé—œé–‰</button>
  <button id="exportBtn">ğŸ“¤ åŒ¯å‡ºå±¤æ¶ç‹€æ…‹</button>
  <div id="reader"></div>

  <h2>ğŸ“· å±¤æ¶æƒæ</h2>
  <select id="statusFilter">
    <option value="">å…¨éƒ¨</option>
    <option value="restock">è£œè²¨</option>
    <option value="move">ç§»ä½</option>
    <option value="empty">ç©ºä½</option>
  </select>

  <div id="statusStats"></div>
  <div id="resultList"></div>

  <script>
    const STORAGE_KEY = "qr-history"; // localStorage ä¸­å„²å­˜è¨˜éŒ„çš„éµå
    const SOUND_KEY = "sound-enabled"; // localStorage ä¸­å„²å­˜éŸ³æ•ˆç‹€æ…‹çš„éµå
    const resultList = document.getElementById("resultList"); // é¡¯ç¤ºæƒæçµæœçš„åˆ—è¡¨å®¹å™¨
    const statusFilter = document.getElementById("statusFilter"); // ç‹€æ…‹ç¯©é¸ä¸‹æ‹‰é¸å–®
    const statusStats = document.getElementById("statusStats"); // ç‹€æ…‹çµ±è¨ˆé¡¯ç¤ºå€
    const exportBtn = document.getElementById("exportBtn"); // åŒ¯å‡ºæŒ‰éˆ•
    const soundBtn = document.getElementById("soundBtn"); // éŸ³æ•ˆé–‹é—œæŒ‰éˆ•

    // Web Audio API ç›¸é—œè®Šæ•¸
    let audioContext = null; // éŸ³è¨Šä¸Šä¸‹æ–‡ï¼Œç”¨æ–¼æ‰€æœ‰éŸ³è¨Šæ“ä½œ
    let gainNode = null;    // å¢ç›Šç¯€é»ï¼Œç”¨æ–¼æ§åˆ¶éŸ³é‡
    let soundEnabled = false; // éŸ³æ•ˆæ˜¯å¦å•Ÿç”¨
    let qrScanner = null; // Html5Qrcode æƒæå™¨å¯¦ä¾‹
    let highlightedElement = null; // ç•¶å‰è¢«é«˜äº®çš„è¨˜éŒ„å…ƒç´ 
    let lastScannedText = ""; // ä¸Šä¸€æ¬¡æƒæåˆ°çš„æ–‡å­—
    let lastScannedTime = 0; // ä¸Šä¸€æ¬¡æƒæçš„æ™‚é–“æˆ³

    // åˆå§‹åŒ–éŸ³æ•ˆ (ä½¿ç”¨ Web Audio API)
    function initSound() {
      // å¾ localStorage è®€å–éŸ³æ•ˆè¨­å®šï¼Œé è¨­ç‚ºé—œé–‰
      soundEnabled = localStorage.getItem(SOUND_KEY) === "true";
      updateSoundButton(); // æ›´æ–°éŸ³æ•ˆæŒ‰éˆ•çš„é¡¯ç¤ºç‹€æ…‹

      // å»¶é²åˆå§‹åŒ– AudioContext ç›´åˆ°ç”¨æˆ¶æœ‰äº¤äº’ï¼Œé¿å…è‡ªå‹•æ’­æ”¾é™åˆ¶
      // ç›£è½éŸ³æ•ˆæŒ‰éˆ•é»æ“Šäº‹ä»¶ï¼Œç¬¬ä¸€æ¬¡é»æ“Šæ™‚è¨­ç½® AudioContext
      soundBtn.addEventListener("click", setupAudioContext, { once: true });
      // æˆ–è€…ç•¶é¦–æ¬¡æˆåŠŸæƒææ™‚ä¹Ÿåˆå§‹åŒ– AudioContextï¼Œç¢ºä¿éŸ³æ•ˆèƒ½è¢«æ’­æ”¾
    }

    // è¨­ç½® AudioContextï¼šåœ¨ç”¨æˆ¶äº’å‹•å¾Œæ‰åŸ·è¡Œï¼Œç¢ºä¿ç€è¦½å™¨å…è¨±æ’­æ”¾éŸ³æ•ˆ
    function setupAudioContext() {
      if (!audioContext) { // åªæœ‰åœ¨ audioContext å°šæœªåˆå§‹åŒ–æ™‚æ‰å»ºç«‹
        audioContext = new (window.AudioContext || window.webkitAudioContext)(); // å»ºç«‹ AudioContext å¯¦ä¾‹
        gainNode = audioContext.createGain(); // å»ºç«‹å¢ç›Šç¯€é»
        gainNode.connect(audioContext.destination); // å°‡å¢ç›Šç¯€é»é€£æ¥åˆ°æšè²å™¨ï¼ˆæœ€çµ‚è¼¸å‡ºï¼‰
        gainNode.gain.value = 0.5; // è¨­ç½®é è¨­éŸ³é‡ç‚º 0.5 (ç¯„åœ 0.0 åˆ° 1.0)
        console.log("AudioContext å·²åˆå§‹åŒ–ã€‚");
      }
    }

    // æ›´æ–°éŸ³æ•ˆæŒ‰éˆ•çš„é¡¯ç¤ºç‹€æ…‹
    function updateSoundButton() {
      if (soundEnabled) {
        soundBtn.textContent = 'ğŸ”Š éŸ³æ•ˆé–‹å•Ÿ'; // é¡¯ç¤ºã€ŒéŸ³æ•ˆé–‹å•Ÿã€
        soundBtn.className = 'enabled'; // æ‡‰ç”¨ enabled æ¨£å¼
      } else {
        soundBtn.textContent = 'ğŸ”‡ éŸ³æ•ˆé—œé–‰'; // é¡¯ç¤ºã€ŒéŸ³æ•ˆé—œé–‰ã€
        soundBtn.className = 'disabled'; // æ‡‰ç”¨ disabled æ¨£å¼
      }
    }

    // æ’­æ”¾å—¶è²
    function playBeep() {
      // å¦‚æœéŸ³æ•ˆå·²é—œé–‰æˆ– AudioContext å°šæœªæº–å‚™å¥½ï¼Œå‰‡ä¸æ’­æ”¾
      if (!soundEnabled || !audioContext) {
        console.log("éŸ³æ•ˆå·²é—œé–‰æˆ– AudioContext å°šæœªæº–å‚™å¥½ã€‚");
        return;
      }

      try {
        // å¦‚æœ AudioContext è™•æ–¼æš«åœç‹€æ…‹ï¼Œå˜—è©¦æ¢å¾©å®ƒï¼ˆä¾‹å¦‚ï¼Œåœ¨ç”¨æˆ¶äº’å‹•å¾Œï¼‰
        if (audioContext.state === 'suspended') {
          audioContext.resume().then(() => {
            console.log("AudioContext å·²æ¢å¾©ã€‚");
            createAndPlayBeep(); // æ¢å¾©æˆåŠŸå¾Œå†æ’­æ”¾å—¶è²
          }).catch(e => console.error("ç„¡æ³•æ¢å¾© AudioContext:", e));
        } else {
          createAndPlayBeep(); // ç›´æ¥æ’­æ”¾å—¶è²
        }
      } catch (e) {
        console.error("æ’­æ”¾å—¶è²æ™‚ç™¼ç”ŸéŒ¯èª¤:", e);
      }
    }

    // å‰µå»ºä¸¦æ’­æ”¾å–®æ¬¡å—¶è²çš„å¯¦éš›é‚è¼¯
    function createAndPlayBeep() {
      if (!audioContext) return; // å†æ¬¡æª¢æŸ¥ï¼Œä»¥é˜²è¬ä¸€

      const oscillator = audioContext.createOscillator(); // å»ºç«‹æŒ¯ç›ªå™¨ç¯€é»ï¼Œç”¨æ–¼ç”Ÿæˆè²æ³¢
      oscillator.type = 'sine'; // è¨­å®šæ³¢å½¢ç‚ºæ­£å¼¦æ³¢ï¼Œè½èµ·ä¾†æœƒæ¯”è¼ƒæŸ”å’Œ
      oscillator.frequency.setValueAtTime(880, audioContext.currentTime); // è¨­å®šé »ç‡ç‚º 880 Hz

      // é€£æ¥æŒ¯ç›ªå™¨åˆ°å¢ç›Šç¯€é»ï¼Œå†é€£æ¥åˆ°è¼¸å‡º
      oscillator.connect(gainNode);

      oscillator.start(); // é–‹å§‹æ’­æ”¾è²éŸ³
      oscillator.stop(audioContext.currentTime + 0.1); // åœ¨ 0.1 ç§’å¾Œåœæ­¢è²éŸ³ï¼Œå½¢æˆçŸ­ä¿ƒçš„å—¶è²
    }

    // éŸ³æ•ˆæŒ‰éˆ•é»æ“Šäº‹ä»¶è™•ç†
    soundBtn.addEventListener("click", function() {
      soundEnabled = !soundEnabled; // åˆ‡æ›éŸ³æ•ˆé–‹é—œç‹€æ…‹
      localStorage.setItem(SOUND_KEY, soundEnabled.toString()); // å„²å­˜ç‹€æ…‹åˆ° localStorage
      updateSoundButton(); // æ›´æ–°æŒ‰éˆ•é¡¯ç¤º

      // å¦‚æœéŸ³æ•ˆé–‹å•Ÿï¼Œå‰‡æ¸¬è©¦æ’­æ”¾ä¸€æ¬¡
      if (soundEnabled) {
        setupAudioContext(); // ç¢ºä¿ AudioContext å·²åˆå§‹åŒ–
        playBeep();
      }
    });

    // åŒ¯å‡ºæŒ‰éˆ•é»æ“Šäº‹ä»¶ï¼Œè§¸ç™¼åŒ¯å‡º CSV åŠŸèƒ½
    exportBtn.onclick = exportCSV;
    // ç‹€æ…‹ç¯©é¸å™¨è®Šæ›´äº‹ä»¶ï¼Œè§¸ç™¼é‡æ–°è¼‰å…¥æ­·å²è¨˜éŒ„
    statusFilter.onchange = loadHistory;

    // è¼‰å…¥ä¸¦é¡¯ç¤ºæ­·å²æƒæè¨˜éŒ„
    function loadHistory() {
      const raw = localStorage.getItem(STORAGE_KEY); // å¾ localStorage ç²å–åŸå§‹è³‡æ–™
      const list = raw ? JSON.parse(raw) : []; // è§£æ JSON å­—ä¸²ï¼Œå¦‚æœç‚ºç©ºå‰‡ç‚ºç©ºé™£åˆ—
      // å®šç¾©ç‹€æ…‹çš„å„ªå…ˆç´šï¼Œç”¨æ–¼æ’åºé¡¯ç¤ºï¼ˆè£œè²¨ > ç§»ä½ > ç©ºä½ > ç„¡ç‹€æ…‹ï¼‰
      const priority = { restock: 3, move: 2, empty: 1, "": 0 };
      list.sort((a, b) => {
        const pa = priority[a.status] || 0;
        const pb = priority[b.status] || 0;
        if (pb !== pa) return pb - pa; // å„ªå…ˆç´šé«˜çš„æ’åœ¨å‰é¢
        return a.data.localeCompare(b.data); // å¦‚æœå„ªå…ˆç´šç›¸åŒï¼Œå‰‡æƒæå…§å®¹æŒ‰å­—æ¯é †åºæ’åˆ—
      });

      // æ ¹æ“šç¯©é¸æ¢ä»¶éæ¿¾é¡¯ç¤ºçš„è¨˜éŒ„
      const filtered = statusFilter.value ? list.filter(i => i.status === statusFilter.value) : list;
      resultList.innerHTML = filtered.map(item => `
        <div class="record" data-time="${item.time}" data-status="${item.status}">
          <div class="left">
            <div>${item.data}</div>
            <div class="time">${new Date(item.time).toLocaleString()}</div>
          </div>
          <div class="options">
            <label><input type="radio" name="opt-${item.time}" value="delete" onchange="handleOptionChange('${item.time}','delete')">åˆªé™¤</label>
            <label data-status="restock"><input type="radio" name="opt-${item.time}" value="restock" ${item.status === 'restock' ? 'checked' : ''} onchange="handleOptionChange('${item.time}','restock')">è£œè²¨</label>
            <label data-status="move"><input type="radio" name="opt-${item.time}" value="move" ${item.status === 'move' ? 'checked' : ''} onchange="handleOptionChange('${item.time}','move')">ç§»ä½</label>
            <label data-status="empty"><input type="radio" name="opt-${item.time}" value="empty" ${item.status === 'empty' ? 'checked' : ''} onchange="handleOptionChange('${item.time}','empty')">ç©ºä½</label>
          </div>
        </div>
      `).join("");

      // è¨ˆç®—ä¸¦é¡¯ç¤ºå„ç‹€æ…‹çš„çµ±è¨ˆæ•¸æ“š
      const stats = { restock: 0, move: 0, empty: 0 };
      list.forEach(i => {
        if (stats.hasOwnProperty(i.status)) {
          stats[i.status]++;
        }
      });
      statusStats.innerHTML = `
        ğŸŸ§ è£œè²¨ï¼š${stats.restock} ç­†&nbsp;&nbsp;
        ğŸ”µ ç§»ä½ï¼š${stats.move} ç­†&nbsp;&nbsp;
        ğŸ”´ ç©ºä½ï¼š${stats.empty} ç­†&nbsp;&nbsp;
        âšª åˆè¨ˆï¼š${list.length} ç­†
      `;
    }

    // æ–°å¢æƒæè¨˜éŒ„
    function addHistory(data) {
      const time = new Date().toISOString(); // è¨˜éŒ„ç•¶å‰æ™‚é–“ï¼ˆISO æ ¼å¼ï¼‰
      const list = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); // è¼‰å…¥ç¾æœ‰è¨˜éŒ„

      // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæƒæå…§å®¹çš„è¨˜éŒ„
      const existingItemIndex = list.findIndex(item => item.data === data);

      if (existingItemIndex > -1) {
        // å¦‚æœå­˜åœ¨ï¼Œå°‡èˆŠè¨˜éŒ„å¾åŸä½ç½®ç§»é™¤
        const existingItem = list.splice(existingItemIndex, 1)[0];
        existingItem.time = time; // æ›´æ–°æ™‚é–“
        list.unshift(existingItem); // å°‡æ›´æ–°å¾Œçš„è¨˜éŒ„ç§»åˆ°æœ€å‰é¢
      } else {
        // å¦‚æœä¸å­˜åœ¨ï¼Œå‰‡æ–°å¢ä¸€ç­†æ–°è¨˜éŒ„åˆ°æœ€å‰é¢ï¼Œç‹€æ…‹é è¨­ç‚ºç©º
        list.unshift({ data, time, status: "" });
      }

      localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); // å„²å­˜å› localStorage
      loadHistory(); // é‡æ–°è¼‰å…¥ä¸¦é¡¯ç¤ºè¨˜éŒ„
      highlightByTime(time); // é«˜äº®é¡¯ç¤ºæ–°è¨˜éŒ„
      playBeep(); // æ’­æ”¾éŸ³æ•ˆ
    }

    // é«˜äº®é¡¯ç¤ºæŒ‡å®šæ™‚é–“çš„è¨˜éŒ„
    function highlightByTime(time) {
      // ç§»é™¤ä¹‹å‰é«˜äº®çš„å…ƒç´ 
      if (highlightedElement) {
        highlightedElement.classList.remove("highlight");
      }
      // å»¶é²ä¸€å°æ®µæ™‚é–“å†é«˜äº®ï¼Œç¢ºä¿å…ƒç´ å·²åœ¨ DOM ä¸­æ›´æ–°
      setTimeout(() => {
        const el = document.querySelector(`.record[data-time="${time}"]`); // æ ¹æ“šæ™‚é–“æ‰¾åˆ°å°æ‡‰çš„è¨˜éŒ„å…ƒç´ 
        if (el) {
          el.classList.add("highlight"); // æ·»åŠ é«˜äº®æ¨£å¼
          el.scrollIntoView({ behavior: "smooth", block: "center" }); // æ²å‹•åˆ°å¯è¦‹å€åŸŸ
          highlightedElement = el; // è¨˜éŒ„ç•¶å‰é«˜äº®çš„å…ƒç´ 
        }
      }, 100);
    }

    // è™•ç†è¨˜éŒ„çš„é¸é …è®Šæ›´ï¼ˆåˆªé™¤ã€è£œè²¨ã€ç§»ä½ã€ç©ºä½ï¼‰
    function handleOptionChange(time, action) {
      const list = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      const idx = list.findIndex(i => i.time === time); // æ‰¾åˆ°å°æ‡‰è¨˜éŒ„çš„ç´¢å¼•
      if (idx === -1) return; // å¦‚æœæ‰¾ä¸åˆ°ï¼Œå‰‡ç›´æ¥è¿”å›

      if (action === "delete") {
        // åˆªé™¤å‰é€²è¡Œç¢ºèª
        if (!confirm(`ç¢ºå®šè¦åˆªé™¤ [${list[idx].data}] é€™ç­†è¨˜éŒ„å—ï¼Ÿ`)) {
          loadHistory(); // å¦‚æœå–æ¶ˆï¼Œé‡æ–°è¼‰å…¥ä»¥æ¢å¾©é¸é …ç‹€æ…‹
          return;
        }
        list.splice(idx, 1); // å¾åˆ—è¡¨ä¸­åˆªé™¤è©²è¨˜éŒ„
      } else {
        list[idx].status = action; // æ›´æ–°è¨˜éŒ„çš„ç‹€æ…‹
      }
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); // å„²å­˜å› localStorage
      loadHistory(); // é‡æ–°è¼‰å…¥é¡¯ç¤º
    }

    // åŒ¯å‡º CSV æª”æ¡ˆ
    function exportCSV() {
      const list = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      if (!list.length) return alert("æ²’æœ‰è³‡æ–™å¯åŒ¯å‡ºï¼"); // å¦‚æœæ²’æœ‰è³‡æ–™ï¼Œå‰‡æç¤ºä¸¦è¿”å›
      
      const header = ["æƒæå…§å®¹", "æ™‚é–“", "ç‹€æ…‹"]; // CSV è¡¨é ­
      const csvRows = [header.join(",")]; // å°‡è¡¨é ­è½‰æ›ç‚º CSV è¡Œ

      // å°‡ç‹€æ…‹ç¢¼è½‰æ›ç‚ºä¸­æ–‡åç¨±
      const statusName = s => {
        if (s === 'restock') return "è£œè²¨";
        if (s === 'move') return "ç§»ä½";
        if (s === 'empty') return "ç©ºä½";
        return ""; // å…¶ä»–æƒ…æ³è¿”å›ç©ºå­—ä¸²
      };

      list.forEach(i => {
        // è™•ç†å…§å®¹ä¸­çš„é›™å¼•è™Ÿï¼ˆç”¨å…©å€‹é›™å¼•è™Ÿè¡¨ç¤ºä¸€å€‹é›™å¼•è™Ÿï¼‰ï¼Œä¸¦åŠ å…¥ç‹€æ…‹åç¨±
        csvRows.push(`"${i.data.replace(/"/g,'""')}","${new Date(i.time).toLocaleString()}","${statusName(i.status)}"`);
      });
      
      const BOM = '\uFEFF'; // UTF-8 BOMï¼ˆä½å…ƒçµ„é †åºæ¨™è¨˜ï¼‰ï¼Œç¢ºä¿ Excel èƒ½æ­£ç¢ºé–‹å•ŸåŒ…å«ä¸­æ–‡çš„ CSV
      const blob = new Blob([BOM + csvRows.join("\r\n")], { type: "text/csv;charset=utf-8;" }); // å»ºç«‹ Blob ç‰©ä»¶
      const url = URL.createObjectURL(blob); // å»ºç«‹ Blob çš„ URL
      const a = document.createElement("a"); // å»ºç«‹ä¸€å€‹éš±è—çš„ <a> å…ƒç´ 
      a.href = url; // è¨­å®šä¸‹è¼‰é€£çµ
      a.download = `å±¤æ¶è¨˜éŒ„_${Date.now()}.csv`; // è¨­å®šä¸‹è¼‰æª”åï¼ŒåŒ…å«æ™‚é–“æˆ³
      a.click(); // æ¨¡æ“¬é»æ“Šä¸‹è¼‰
      URL.revokeObjectURL(url); // é‡‹æ”¾ Blob URL è³‡æº
    }

    // å•Ÿå‹• QR æƒæå™¨
    function startScanner() {
      // å¦‚æœæƒæå™¨å·²å•Ÿå‹•å‰‡ä¸é‡è¤‡å•Ÿå‹•
      if (qrScanner && qrScanner.isScanning) return; 
      
      qrScanner = new Html5Qrcode("reader"); // å¯¦ä¾‹åŒ– Html5Qrcodeï¼Œä¸¦æŒ‡å®šæ¸²æŸ“çš„ div ID
      qrScanner.start(
        { facingMode: "environment" }, // ä½¿ç”¨å¾Œç½®é¡é ­ ("user" ç‚ºå‰ç½®é¡é ­)
        { fps: 10, qrbox: { width: 250, height: 250 } }, // æ¯ç§’å¹€æ•¸å’Œæƒææ¡†å¤§å°
        decodedText => { // æˆåŠŸæƒæåˆ° QR code æ™‚çš„å›èª¿å‡½æ•¸
          const now = Date.now();
          // å¢åŠ ä¸€å€‹çŸ­æ™‚é–“å…§çš„é‡è¤‡æƒæéæ¿¾ï¼Œé¿å…éæ–¼é »ç¹çš„å—¶è²å’Œé‡è¤‡è¨˜éŒ„
          // å¦‚æœæƒæå…§å®¹èˆ‡ä¸Šæ¬¡ç›¸åŒä¸”æ™‚é–“é–“éš”å°æ–¼ 3 ç§’ï¼Œå‰‡å¿½ç•¥
          if (decodedText === lastScannedText && now - lastScannedTime < 3000) return;
          
          lastScannedText = decodedText; // æ›´æ–°ä¸Šæ¬¡æƒæçš„æ–‡å­—
          lastScannedTime = now; // æ›´æ–°ä¸Šæ¬¡æƒæçš„æ™‚é–“
          
          addHistory(decodedText); // æ–°å¢æƒæè¨˜éŒ„
          setupAudioContext(); // ç¢ºä¿ AudioContext åœ¨é¦–æ¬¡æƒææˆåŠŸæ™‚åˆå§‹åŒ–
        },
        errorMessage => {} // æƒæéŒ¯èª¤æ™‚çš„å›èª¿å‡½æ•¸ï¼ˆæ­¤è™•ç•™ç©ºä¸è™•ç†éŒ¯èª¤è¨Šæ¯ï¼‰
      ).catch(err => { // å•Ÿå‹•æƒæå™¨å¤±æ•—æ™‚çš„éŒ¯èª¤è™•ç†
        console.error("ç„¡æ³•å•Ÿå‹•QRæƒæå™¨", err);
        alert("ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿï¼Œè«‹ç¢ºèªå·²æˆæ¬Šç€è¦½å™¨ä½¿ç”¨ç›¸æ©Ÿçš„æ¬Šé™ã€‚");
      });
    }

    // é é¢è¼‰å…¥æ™‚çš„åˆå§‹åŒ–å‹•ä½œ
    initSound();     // åˆå§‹åŒ–éŸ³æ•ˆè¨­å®š
    loadHistory();   // è¼‰å…¥ä¸¦é¡¯ç¤ºæ­·å²è¨˜éŒ„
    startScanner();  // å•Ÿå‹• QR æƒæå™¨
  </script>
</body>
</html>